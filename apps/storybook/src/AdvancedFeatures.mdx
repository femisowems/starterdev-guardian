import { Meta, Story, Canvas, Controls } from '@storybook/blocks';
import * as AdvancedFeaturesStories from './AdvancedFeatures.stories';

<Meta of={AdvancedFeaturesStories} />

# Advanced Forms


Take control of complex form logic with Zod integration, cross-field policies, and async validation.

## Overview

The "Advanced Features" set demonstrates the full power of the Guardian Form library. From rigid schema validation to dynamic risk scoring, these tools allow you to build sophisticated enterprise forms with ease.

## Key Capabilities

<table className="gf-docs-table">
  <thead>
    <tr>
      <th align="left">Capability</th>
      <th align="left">Description</th>
      <th align="left">Primary Use Case</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Zod Integration</strong></td>
      <td>Seamless integration with schema-based validation via the `zodAdapter`.</td>
      <td>Complex validation rules and backend-aligned schemas.</td>
    </tr>
    <tr>
      <td><strong>Risk Meter</strong></td>
      <td>Real-time visualization of compliance risk based on data density and policy violations.</td>
      <td>High-compliance forms requiring instant governance feedback.</td>
    </tr>
    <tr>
      <td><strong>Cross-field Policies</strong></td>
      <td>Support for business logic where field validity depends on other field values.</td>
      <td>Conditional requirements (e.g., Authorized Approver if SSN is present).</td>
    </tr>
  </tbody>
</table>

### Technical Implementation

#### Zod Integration
Seamlessly integrate with your existing schema-based validation. The `zodAdapter` translates Zod errors into a format the `GuardianFormProvider` understands.

```tsx
const schema = z.object({
  email: z.string().email(),
  ssn: z.string().length(9),
});

<GuardianFormProvider
  validate={zodAdapter(schema)}
  ...
>
```

#### Cross-field Policies
Implement complex business logic where the validity of one field depends on another.

```tsx
export const DependentFieldPolicy = (field: string, requiredBy: string): PolicyRule => ({
  id: 'dependent-field',
  evaluate: (val, _, allVals) => {
    if (allVals[requiredBy] && !val) {
      return { ruleId: 'dependent-field', message: `${field} is required when ${requiredBy} is provided`, severity: 'ERROR' };
    }
    return null;
  }
});
```


## Examples

### Enterprise Governance
A comprehensive demo featuring Zod validation, the Risk Meter, and cross-field dependency logic.

<Canvas of={AdvancedFeaturesStories.EnterpriseGovernance} />

### Async Validation
Demonstrates library support for asynchronous server-side checks (e.g., checking username availability) with built-in loading states.

<Canvas of={AdvancedFeaturesStories.AsyncValidationDemo} />

## Properties & Configuration

<Controls />
